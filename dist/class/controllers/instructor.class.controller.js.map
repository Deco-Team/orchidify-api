{"version":3,"file":"instructor.class.controller.js","sourceRoot":"/","sources":["class/controllers/instructor.class.controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { Controller, Get, UseGuards, Inject, Query, Param, Req, Post, Body, Patch } from '@nestjs/common'\r\nimport { ApiBadRequestResponse, ApiBearerAuth, ApiOkResponse, ApiOperation, ApiQuery, ApiTags } from '@nestjs/swagger'\r\nimport * as _ from 'lodash'\r\n\r\nimport { ErrorResponse, PaginationQuery, SuccessDataResponse, SuccessResponse } from '@common/contracts/dto'\r\nimport { Roles } from '@auth/decorators/roles.decorator'\r\nimport { ClassStatus, SubmissionStatus, UserRole } from '@common/contracts/constant'\r\nimport { JwtAuthGuard } from '@auth/guards/jwt-auth.guard'\r\nimport { RolesGuard } from '@auth/guards/roles.guard'\r\nimport { AppException } from '@common/exceptions/app.exception'\r\nimport { Errors } from '@common/contracts/error'\r\nimport { ApiErrorResponse } from '@common/decorators/api-response.decorator'\r\nimport { IClassService } from '@class/services/class.service'\r\nimport { Pagination, PaginationParams } from '@common/decorators/pagination.decorator'\r\nimport {\r\n  InstructorViewClassDetailDataResponse,\r\n  InstructorViewClassListDataResponse,\r\n  QueryClassDto\r\n} from '@class/dto/view-class.dto'\r\nimport { CLASS_DETAIL_PROJECTION } from '@class/contracts/constant'\r\nimport { IAssignmentService } from '@class/services/assignment.service'\r\nimport { ViewAssignmentDetailDataResponse } from '@class/dto/view-assignment.dto'\r\nimport { ISessionService } from '@class/services/session.service'\r\nimport { ViewSessionDetailDataResponse } from '@class/dto/view-session.dto'\r\nimport { ILearnerClassService } from '@class/services/learner-class.service'\r\nimport { Types } from 'mongoose'\r\nimport { IAssignmentSubmissionService } from '@class/services/assignment-submission.service'\r\nimport { AssignmentSubmissionListDataResponse } from '@class/dto/view-assignment-submission.dto'\r\nimport { GradeAssignmentSubmissionDto } from '@class/dto/assignment-submission.dto'\r\nimport { UploadSessionResourcesDto } from '@class/dto/session.dto'\r\n\r\n@ApiTags('Class - Instructor')\r\n@ApiBearerAuth()\r\n@ApiBadRequestResponse({ type: ErrorResponse })\r\n@UseGuards(JwtAuthGuard.ACCESS_TOKEN, RolesGuard)\r\n@Roles(UserRole.INSTRUCTOR)\r\n@Controller('instructor')\r\nexport class InstructorClassController {\r\n  constructor(\r\n    @Inject(IClassService)\r\n    private readonly classService: IClassService,\r\n    @Inject(ISessionService)\r\n    private readonly sessionService: ISessionService,\r\n    @Inject(IAssignmentService)\r\n    private readonly assignmentService: IAssignmentService,\r\n    @Inject(ILearnerClassService)\r\n    private readonly learnerClassService: ILearnerClassService,\r\n    @Inject(IAssignmentSubmissionService)\r\n    private readonly assignmentSubmissionService: IAssignmentSubmissionService\r\n  ) {}\r\n\r\n  @ApiOperation({\r\n    summary: `View Class List`\r\n  })\r\n  @ApiQuery({ type: PaginationQuery })\r\n  @ApiOkResponse({ type: InstructorViewClassListDataResponse })\r\n  @Get()\r\n  async list(@Req() req, @Pagination() pagination: PaginationParams, @Query() queryClassDto: QueryClassDto) {\r\n    const { _id } = _.get(req, 'user')\r\n    return await this.classService.listByInstructor(_id, pagination, queryClassDto)\r\n  }\r\n\r\n  @ApiOperation({\r\n    summary: `View Class Detail`\r\n  })\r\n  @ApiOkResponse({ type: InstructorViewClassDetailDataResponse })\r\n  @ApiErrorResponse([Errors.CLASS_NOT_FOUND])\r\n  @Get(':id([0-9a-f]{24})')\r\n  async getDetail(@Req() req, @Param('id') classId: string) {\r\n    const { _id } = _.get(req, 'user')\r\n    const [courseClass, learnerClass] = await Promise.all([\r\n      this.classService.findById(classId, CLASS_DETAIL_PROJECTION, [\r\n        {\r\n          path: 'garden',\r\n          select: ['name']\r\n        },\r\n        {\r\n          path: 'course',\r\n          select: ['code']\r\n        }\r\n      ]),\r\n      this.learnerClassService.findMany({ classId: new Types.ObjectId(classId) }, undefined, [{ path: 'learner' }])\r\n    ])\r\n    if (!courseClass || courseClass.instructorId?.toString() !== _id) throw new AppException(Errors.CLASS_NOT_FOUND)\r\n\r\n    return { ...courseClass.toJSON(), learners: learnerClass?.map((learnerClass) => learnerClass?.['learner']) }\r\n  }\r\n\r\n  @ApiOperation({\r\n    summary: `View Session Detail`\r\n  })\r\n  @ApiOkResponse({ type: ViewSessionDetailDataResponse })\r\n  @ApiErrorResponse([Errors.SESSION_NOT_FOUND])\r\n  @Get(':classId([0-9a-f]{24})/sessions/:sessionId([0-9a-f]{24})')\r\n  async getLessonDetail(@Req() req, @Param('classId') classId: string, @Param('sessionId') sessionId: string) {\r\n    const { _id: instructorId } = _.get(req, 'user')\r\n    const session = await this.sessionService.findOneBy({ sessionId, classId, instructorId })\r\n\r\n    if (!session) throw new AppException(Errors.SESSION_NOT_FOUND)\r\n    return session\r\n  }\r\n\r\n  @ApiOperation({\r\n    summary: `View Assignment Detail`\r\n  })\r\n  @ApiOkResponse({ type: ViewAssignmentDetailDataResponse })\r\n  @ApiErrorResponse([Errors.ASSIGNMENT_NOT_FOUND])\r\n  @Get(':classId([0-9a-f]{24})/assignments/:assignmentId([0-9a-f]{24})')\r\n  async getAssignmentDetail(\r\n    @Req() req,\r\n    @Param('classId') classId: string,\r\n    @Param('assignmentId') assignmentId: string\r\n  ) {\r\n    const { _id: instructorId } = _.get(req, 'user')\r\n    const assignment = await this.assignmentService.findOneBy({ assignmentId, classId, instructorId })\r\n\r\n    if (!assignment) throw new AppException(Errors.ASSIGNMENT_NOT_FOUND)\r\n    return assignment\r\n  }\r\n\r\n  @ApiOperation({\r\n    summary: `View Assignment Submission List`\r\n  })\r\n  @ApiOkResponse({ type: AssignmentSubmissionListDataResponse })\r\n  @ApiErrorResponse([Errors.CLASS_NOT_FOUND])\r\n  @Get(':classId([0-9a-f]{24})/assignments/:assignmentId([0-9a-f]{24})/submissions')\r\n  async listAssignmentSubmission(\r\n    @Req() req,\r\n    @Param('classId') classId: string,\r\n    @Param('assignmentId') assignmentId: string\r\n  ) {\r\n    const { _id } = _.get(req, 'user')\r\n\r\n    const courseClass = await this.classService.findById(classId, CLASS_DETAIL_PROJECTION)\r\n    if (!courseClass || courseClass.instructorId?.toString() !== _id) throw new AppException(Errors.CLASS_NOT_FOUND)\r\n\r\n    return await this.assignmentSubmissionService.list({ classId, assignmentId })\r\n  }\r\n\r\n  @ApiOperation({\r\n    summary: `View Assignment Submission Detail`\r\n  })\r\n  @ApiOkResponse({ type: AssignmentSubmissionListDataResponse })\r\n  @ApiErrorResponse([Errors.CLASS_NOT_FOUND, Errors.ASSIGNMENT_SUBMISSION_NOT_FOUND])\r\n  @Get(':classId([0-9a-f]{24})/assignment-submissions/:submissionId([0-9a-f]{24})')\r\n  async getAssignmentSubmissionDetail(\r\n    @Req() req,\r\n    @Param('classId') classId: string,\r\n    @Param('submissionId') submissionId: string\r\n  ) {\r\n    const { _id } = _.get(req, 'user')\r\n\r\n    const courseClass = await this.classService.findById(classId, CLASS_DETAIL_PROJECTION)\r\n    if (!courseClass || courseClass.instructorId?.toString() !== _id) throw new AppException(Errors.CLASS_NOT_FOUND)\r\n\r\n    const submission = await this.assignmentSubmissionService.findById(submissionId, undefined, [\r\n      {\r\n        path: 'learner',\r\n        select: ['_id', 'name', 'email', 'avatar']\r\n      }\r\n    ])\r\n    if (!submission || submission.classId?.toString() !== classId)\r\n      throw new AppException(Errors.ASSIGNMENT_SUBMISSION_NOT_FOUND)\r\n\r\n    return submission\r\n  }\r\n\r\n  @ApiOperation({\r\n    summary: `Grade Assignment Submission`\r\n  })\r\n  @ApiOkResponse({ type: SuccessDataResponse })\r\n  @ApiErrorResponse([\r\n    Errors.CLASS_NOT_FOUND,\r\n    Errors.ASSIGNMENT_SUBMISSION_NOT_FOUND,\r\n    Errors.ASSIGNMENT_SUBMISSION_GRADED\r\n  ])\r\n  @Post(':classId([0-9a-f]{24})/assignment-submissions/:submissionId([0-9a-f]{24})/grade')\r\n  async gradeAssignmentSubmission(\r\n    @Req() req,\r\n    @Param('classId') classId: string,\r\n    @Param('submissionId') submissionId: string,\r\n    @Body() gradeAssignmentSubmissionDto: GradeAssignmentSubmissionDto\r\n  ) {\r\n    const { _id } = _.get(req, 'user')\r\n\r\n    const courseClass = await this.classService.findById(classId, CLASS_DETAIL_PROJECTION)\r\n    if (!courseClass || courseClass.instructorId?.toString() !== _id) throw new AppException(Errors.CLASS_NOT_FOUND)\r\n\r\n    const submission = await this.assignmentSubmissionService.findById(submissionId)\r\n    if (!submission || submission.classId?.toString() !== classId)\r\n      throw new AppException(Errors.ASSIGNMENT_SUBMISSION_NOT_FOUND)\r\n\r\n    // check already graded or not\r\n    if (submission.point !== undefined) throw new AppException(Errors.ASSIGNMENT_SUBMISSION_GRADED)\r\n\r\n    const { point, feedback } = gradeAssignmentSubmissionDto\r\n    await this.assignmentSubmissionService.update(\r\n      { _id: submissionId },\r\n      {\r\n        point,\r\n        feedback,\r\n        status: SubmissionStatus.GRADED\r\n      }\r\n    )\r\n    return new SuccessResponse(true)\r\n  }\r\n\r\n  @ApiOperation({\r\n    summary: `Upload Session Resources`\r\n  })\r\n  @ApiOkResponse({ type: SuccessDataResponse })\r\n  @ApiErrorResponse([Errors.CLASS_NOT_FOUND, Errors.SESSION_NOT_FOUND, Errors.CLASS_NOT_START_YET, Errors.CLASS_ENDED])\r\n  @Patch(':classId([0-9a-f]{24})/sessions/:sessionId([0-9a-f]{24})/upload-resources')\r\n  async uploadSessionResources(\r\n    @Req() req,\r\n    @Param('classId') classId: string,\r\n    @Param('sessionId') sessionId: string,\r\n    @Body() uploadSessionResourcesDto: UploadSessionResourcesDto\r\n  ) {\r\n    const { _id: instructorId } = _.get(req, 'user')\r\n\r\n    const courseClass = await this.classService.findById(classId, '+sessions')\r\n    if (!courseClass || courseClass.instructorId.toString() !== instructorId)\r\n      throw new AppException(Errors.CLASS_NOT_FOUND)\r\n\r\n    // BR-44: After the class starts, instructors can upload more sessionâ€™s resources.\r\n    if (courseClass.status === ClassStatus.COMPLETED) throw new AppException(Errors.CLASS_ENDED)\r\n    if (courseClass.status !== ClassStatus.IN_PROGRESS) throw new AppException(Errors.CLASS_NOT_START_YET)\r\n\r\n    const session = courseClass?.sessions.find((session) => session._id.toString() === sessionId)\r\n    if (!session) throw new AppException(Errors.SESSION_NOT_FOUND)\r\n\r\n    const originalMedia = session.media.filter((media) => media.isAddedLater !== true)\r\n\r\n    const additionalMedia = uploadSessionResourcesDto.media.map((media) => ({ ...media, isAddedLater: true }))\r\n\r\n    const media = [...originalMedia, ...additionalMedia]\r\n\r\n    await this.classService.update(\r\n      { _id: new Types.ObjectId(classId) },\r\n      {\r\n        $set: {\r\n          'sessions.$[i].media': media\r\n        }\r\n      },\r\n      {\r\n        arrayFilters: [\r\n          {\r\n            'i._id': new Types.ObjectId(sessionId)\r\n          }\r\n        ]\r\n      }\r\n    )\r\n\r\n    return new SuccessResponse(true)\r\n  }\r\n}\r\n"]}
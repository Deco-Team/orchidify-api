{"version":3,"file":"class.schema.js","sourceRoot":"/","sources":["class/schemas/class.schema.ts"],"names":[],"mappings":"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","sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose'\r\nimport { HydratedDocument, Types } from 'mongoose'\r\nimport * as paginate from 'mongoose-paginate-v2'\r\nimport { Transform } from 'class-transformer'\r\nimport { ClassStatus, SlotNumber, UserRole, Weekday } from '@common/contracts/constant'\r\nimport { Instructor } from '@instructor/schemas/instructor.schema'\r\nimport { Garden } from '@garden/schemas/garden.schema'\r\nimport { BaseMediaDto } from '@media/dto/base-media.dto'\r\nimport { Session, SessionSchema } from './session.schema'\r\nimport { CourseLevel } from '@src/common/contracts/constant'\r\nimport { Course } from '@course/schemas/course.schema'\r\nimport { BaseRatingSummaryDto } from '@class/dto/rating-summary.dto'\r\n\r\nexport type ClassDocument = HydratedDocument<Class>\r\n\r\nexport class ClassStatusHistory {\r\n  @Prop({ enum: ClassStatus, required: true })\r\n  status: ClassStatus\r\n\r\n  @Prop({ type: Date, required: true })\r\n  timestamp: Date\r\n\r\n  @Prop({ type: Types.ObjectId })\r\n  userId: Types.ObjectId\r\n\r\n  @Prop({ type: String, enum: UserRole })\r\n  userRole: UserRole\r\n}\r\n\r\nexport class Progress {\r\n  @Prop({ type: Number, required: true })\r\n  total: number\r\n\r\n  @Prop({ type: Number, required: true, default: 0 })\r\n  completed: number\r\n\r\n  @Prop({ type: Number, required: true, default: 0 })\r\n  percentage: number\r\n}\r\n\r\n@Schema({\r\n  collection: 'classes',\r\n  timestamps: {\r\n    createdAt: true,\r\n    updatedAt: true\r\n  },\r\n  toJSON: {\r\n    transform(doc, ret) {\r\n      delete ret.__v\r\n    },\r\n    virtuals: true\r\n  },\r\n  toObject: {\r\n    virtuals: true\r\n  }\r\n})\r\nexport class Class {\r\n  constructor(id?: string) {\r\n    this._id = id\r\n  }\r\n  @Transform(({ value }) => value?.toString())\r\n  _id: string\r\n\r\n  @Prop({ type: String, required: true })\r\n  code: string\r\n\r\n  @Prop({ type: String, required: true })\r\n  title: string\r\n\r\n  @Prop({ type: String, required: true })\r\n  description: string\r\n\r\n  @Prop({ type: Date })\r\n  startDate: Date\r\n\r\n  @Prop({ type: Number, required: true })\r\n  price: number\r\n\r\n  @Prop({ enum: CourseLevel, required: true })\r\n  level: string\r\n\r\n  @Prop({ type: [String] })\r\n  type: string[]\r\n\r\n  @Prop({ type: Number })\r\n  duration: number\r\n\r\n  @Prop({ type: String, required: true })\r\n  thumbnail: string\r\n\r\n  @Prop({ type: [BaseMediaDto], required: true })\r\n  media: BaseMediaDto[]\r\n\r\n  @Prop({ type: [SessionSchema], select: false })\r\n  sessions: Session[]\r\n\r\n  @Prop({\r\n    enum: ClassStatus,\r\n    default: ClassStatus.PUBLISHED\r\n  })\r\n  status: ClassStatus\r\n\r\n  @Prop({\r\n    type: [ClassStatusHistory]\r\n  })\r\n  histories: ClassStatusHistory[]\r\n\r\n  @Prop({ type: Number })\r\n  learnerLimit: number\r\n\r\n  @Prop({ type: Number })\r\n  learnerQuantity: number\r\n\r\n  @Prop({ type: [String], enum: Weekday })\r\n  weekdays: Weekday[]\r\n\r\n  @Prop({ type: [Number], enum: SlotNumber })\r\n  slotNumbers: SlotNumber[]\r\n\r\n  @Prop({ type: Number })\r\n  rate: number\r\n\r\n  @Prop({ type: String })\r\n  cancelReason: string\r\n\r\n  @Prop({ type: String })\r\n  gardenRequiredToolkits: string\r\n\r\n  @Prop({ type: Types.ObjectId, ref: Instructor.name, required: true })\r\n  instructorId: Types.ObjectId\r\n\r\n  @Prop({ type: Types.ObjectId, ref: Garden.name })\r\n  gardenId: Types.ObjectId\r\n\r\n  @Prop({ type: Types.ObjectId, ref: Course.name, required: true })\r\n  courseId: Types.ObjectId\r\n\r\n  @Prop({ type: Progress, required: true })\r\n  progress: Progress\r\n\r\n  @Prop({ type: BaseRatingSummaryDto })\r\n  ratingSummary: BaseRatingSummaryDto\r\n}\r\n\r\nexport const ClassSchema = SchemaFactory.createForClass(Class)\r\nClassSchema.plugin(paginate)\r\nClassSchema.index({ title: 'text' })\r\n\r\nClassSchema.virtual('garden', {\r\n  ref: 'Garden',\r\n  localField: 'gardenId',\r\n  foreignField: '_id',\r\n  justOne: true\r\n})\r\n\r\nClassSchema.virtual('instructor', {\r\n  ref: 'Instructor',\r\n  localField: 'instructorId',\r\n  foreignField: '_id',\r\n  justOne: true\r\n})\r\n\r\nClassSchema.virtual('learnerClass', {\r\n  ref: 'LearnerClass',\r\n  localField: '_id',\r\n  foreignField: 'classId',\r\n  justOne: true\r\n})\r\n\r\nClassSchema.virtual('course', {\r\n  ref: 'Course',\r\n  localField: 'courseId',\r\n  foreignField: '_id',\r\n  justOne: true\r\n})\r\n"]}
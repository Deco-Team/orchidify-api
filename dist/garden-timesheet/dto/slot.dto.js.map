{"version":3,"file":"slot.dto.js","sourceRoot":"/","sources":["garden-timesheet/dto/slot.dto.ts"],"names":[],"mappings":"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","sourcesContent":["import { IsDateString, IsMongoId } from 'class-validator'\r\nimport * as moment from 'moment-timezone'\r\nimport { ApiProperty, ApiPropertyOptional, PickType } from '@nestjs/swagger'\r\nimport { SlotNumber, SlotStatus } from '@common/contracts/constant'\r\nimport { Types } from 'mongoose'\r\nimport { VN_TIMEZONE } from '@src/config'\r\nimport { BaseClassDto } from '@class/dto/base.class.dto'\r\nimport { ClassCourseDetailResponse, ClassGardenDetailResponse } from '@class/dto/view-class.dto'\r\nimport { SLOT_CLASS_DETAIL_PROJECTION } from '@garden-timesheet/contracts/constant'\r\n\r\nexport class BaseSlotMetadataDto extends PickType(BaseClassDto, ['code', 'title']) {\r\n  @ApiProperty({ type: Number })\r\n  sessionNumber?: number\r\n\r\n  @ApiProperty({ type: String, example: 'Session title' })\r\n  sessionTitle?: string\r\n}\r\n\r\nexport class BaseSlotDto {\r\n  @ApiProperty({ type: String })\r\n  @IsMongoId()\r\n  _id: string\r\n\r\n  @ApiProperty({ enum: SlotNumber })\r\n  slotNumber: SlotNumber\r\n\r\n  @ApiProperty({ type: Date })\r\n  @IsDateString({ strict: true })\r\n  start: Date\r\n\r\n  @ApiProperty({ type: Date })\r\n  @IsDateString({ strict: true })\r\n  end: Date\r\n\r\n  @ApiProperty({ enum: SlotStatus })\r\n  status: SlotStatus\r\n\r\n  @ApiPropertyOptional({ type: String })\r\n  instructorId: string | Types.ObjectId\r\n\r\n  @ApiPropertyOptional({ type: String })\r\n  sessionId: string | Types.ObjectId\r\n\r\n  @ApiPropertyOptional({ type: String })\r\n  classId: string | Types.ObjectId\r\n\r\n  @ApiPropertyOptional({ type: BaseSlotMetadataDto })\r\n  metadata: BaseSlotMetadataDto\r\n\r\n  @ApiPropertyOptional({ type: Boolean })\r\n  hasTakenAttendance: boolean\r\n}\r\n\r\nexport class CreateSlotDto extends PickType(BaseSlotDto, [\r\n  'slotNumber',\r\n  'start',\r\n  'end',\r\n  'status',\r\n  'instructorId',\r\n  'sessionId',\r\n  'classId',\r\n  'metadata'\r\n]) {\r\n  constructor(\r\n    slotNumber: SlotNumber,\r\n    date: Date,\r\n    instructorId?: Types.ObjectId,\r\n    sessionId?: Types.ObjectId,\r\n    classId?: Types.ObjectId,\r\n    metadata?: BaseSlotMetadataDto\r\n  ) {\r\n    const startOfDate = moment(date).tz(VN_TIMEZONE).startOf('day')\r\n    super()\r\n    this.slotNumber = slotNumber\r\n    this.status = SlotStatus.NOT_AVAILABLE\r\n    this.instructorId = instructorId\r\n    this.sessionId = sessionId\r\n    this.classId = classId\r\n    this.metadata = metadata\r\n    switch (slotNumber) {\r\n      case SlotNumber.ONE:\r\n        this.start = startOfDate.clone().add(7, 'hour').toDate()\r\n        this.end = startOfDate.clone().add(9, 'hour').toDate()\r\n        break\r\n      case SlotNumber.TWO:\r\n        this.start = startOfDate.clone().add(9, 'hour').add(30, 'minute').toDate()\r\n        this.end = startOfDate.clone().add(11, 'hour').add(30, 'minute').toDate()\r\n        break\r\n      case SlotNumber.THREE:\r\n        this.start = startOfDate.clone().add(13, 'hour').toDate()\r\n        this.end = startOfDate.clone().add(15, 'hour').toDate()\r\n        break\r\n      case SlotNumber.FOUR:\r\n        this.start = startOfDate.clone().add(15, 'hour').add(30, 'minute').toDate()\r\n        this.end = startOfDate.clone().add(17, 'hour').add(30, 'minute').toDate()\r\n        break\r\n    }\r\n  }\r\n}\r\n\r\nclass SlotClassDetailResponse extends PickType(BaseClassDto, SLOT_CLASS_DETAIL_PROJECTION) {\r\n  @ApiProperty({ type: ClassCourseDetailResponse })\r\n  course: ClassCourseDetailResponse\r\n}\r\nexport class ViewSlotDto extends BaseSlotDto {\r\n  @ApiProperty({ type: ClassGardenDetailResponse })\r\n  garden: ClassGardenDetailResponse\r\n\r\n  @ApiProperty({ type: SlotClassDetailResponse })\r\n  class: SlotClassDetailResponse\r\n\r\n  @ApiProperty({ type: Date })\r\n  createdAt: Date\r\n\r\n  @ApiProperty({ type: Date })\r\n  updatedAt: Date\r\n}\r\n"]}
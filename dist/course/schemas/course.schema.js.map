{"version":3,"file":"course.schema.js","sourceRoot":"/","sources":["course/schemas/course.schema.ts"],"names":[],"mappings":"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","sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose'\r\nimport { HydratedDocument, Types } from 'mongoose'\r\nimport * as paginate from 'mongoose-paginate-v2'\r\nimport { Transform } from 'class-transformer'\r\nimport { CourseStatus } from '@common/contracts/constant'\r\nimport { Instructor } from '@instructor/schemas/instructor.schema'\r\nimport { BaseMediaDto } from '@media/dto/base-media.dto'\r\nimport { Session, SessionSchema } from '@class/schemas/session.schema'\r\nimport { CourseLevel } from '@src/common/contracts/constant'\r\nimport { BaseRatingSummaryDto } from '@class/dto/rating-summary.dto'\r\n\r\nexport type CourseDocument = HydratedDocument<Course>\r\n\r\n@Schema({\r\n  collection: 'courses',\r\n  timestamps: {\r\n    createdAt: true,\r\n    updatedAt: true\r\n  },\r\n  toJSON: {\r\n    transform(doc, ret) {\r\n      delete ret.__v\r\n    },\r\n    virtuals: true\r\n  },\r\n  toObject: {\r\n    virtuals: true\r\n  }\r\n})\r\nexport class Course {\r\n  constructor(id?: string) {\r\n    this._id = id\r\n  }\r\n  @Transform(({ value }) => value?.toString())\r\n  _id: string\r\n\r\n  @Prop({ type: String, required: true })\r\n  code: string\r\n\r\n  @Prop({ type: String, required: true })\r\n  title: string\r\n\r\n  @Prop({ type: String, required: true })\r\n  description: string\r\n\r\n  @Prop({ type: Number })\r\n  price: number\r\n\r\n  @Prop({ enum: CourseLevel })\r\n  level: string\r\n\r\n  @Prop({ type: [String] })\r\n  type: string[]\r\n\r\n  @Prop({ type: Number })\r\n  duration: number\r\n\r\n  @Prop({ type: String })\r\n  thumbnail: string\r\n\r\n  @Prop({ type: [BaseMediaDto] })\r\n  media: BaseMediaDto[]\r\n\r\n  @Prop({\r\n    enum: CourseStatus,\r\n    default: CourseStatus.DRAFT\r\n  })\r\n  status: CourseStatus\r\n\r\n  @Prop({ type: [SessionSchema], select: false })\r\n  sessions: Session[]\r\n\r\n  @Prop({ type: [{ type: Types.ObjectId, ref: Course.name }] })\r\n  childCourseIds: Types.ObjectId[]\r\n\r\n  @Prop({ type: Number })\r\n  learnerLimit: number\r\n\r\n  @Prop({ type: Number, default: 0 })\r\n  learnerQuantity: number\r\n\r\n  @Prop({ type: Number })\r\n  rate: number\r\n\r\n  @Prop({ type: Number })\r\n  discount: number\r\n\r\n  @Prop({ type: String })\r\n  gardenRequiredToolkits: string\r\n\r\n  @Prop({ type: Types.ObjectId, ref: Instructor.name, required: true })\r\n  instructorId: Types.ObjectId\r\n\r\n  @Prop({ type: Boolean, default: false })\r\n  isRequesting: boolean\r\n\r\n  @Prop({ type: BaseRatingSummaryDto })\r\n  ratingSummary: BaseRatingSummaryDto\r\n}\r\n\r\nexport const CourseSchema = SchemaFactory.createForClass(Course)\r\nCourseSchema.plugin(paginate)\r\nCourseSchema.index({ title: 'text' })\r\n\r\nCourseSchema.virtual('classes', {\r\n  ref: 'Class',\r\n  localField: '_id',\r\n  foreignField: 'courseId'\r\n})\r\n\r\nCourseSchema.virtual('instructor', {\r\n  ref: 'Instructor',\r\n  localField: 'instructorId',\r\n  foreignField: '_id',\r\n  justOne: true\r\n})\r\n\r\nCourseSchema.virtual('childCourses', {\r\n  ref: 'Course',\r\n  localField: 'childCourseIds',\r\n  foreignField: '_id'\r\n})\r\n\r\nCourseSchema.virtual('combos', {\r\n  ref: 'Course',\r\n  localField: '_id',\r\n  foreignField: 'childCourseIds'\r\n})\r\n"]}